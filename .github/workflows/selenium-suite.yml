name: Run Selenium Tests on Cloud

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Choose environment'
        required: true
        default: stage
        type: choice
        options:
          - stage
          - prod
      testClass:
        description: 'Optional: Fully qualified test class or method (e.g., com.liftofftech.falcon.tests.image.ImageGeneratorTests)'
        required: false
        default: ''

jobs:
  run-tests:
    runs-on: ubuntu-latest

    steps:
    # 1️⃣ Checkout the repository
    - name: Checkout repository
      uses: actions/checkout@v3

    # 2️⃣ Set up Java
    - name: Set up Java
      uses: actions/setup-java@v3
      with:
        distribution: 'temurin'   # Required in v3
        java-version: '17'

    # 3️⃣ Run Maven tests
    - name: Run Maven tests
      run: |
        # Only pass -Dtest if input is not empty
        if [ -z "${{ github.event.inputs.testClass }}" ]; then
          TEST_CLASS_ARG=""
        else
          TEST_CLASS_ARG="-Dtest=${{ github.event.inputs.testClass }}"
        fi

        # Run tests based on environment
        if [ "${{ github.event.inputs.environment }}" == "stage" ]; then
          echo "Running tests in STAGE environment..."
          mvn clean test -U -Dconfig.file=property.stage.config $TEST_CLASS_ARG
        else
          echo "Running tests in PROD environment..."
          mvn clean test -U -Dconfig.file=property.prod.config $TEST_CLASS_ARG
        fi
