name: Run Selenium Tests

on:
  workflow_dispatch:
    inputs:
      environment:
        description: 'Environment to run tests against'
        required: true
        type: choice
        options:
          - local
          - stage
          - prod
        default: 'stage'
      module:
        description: 'Module to test (select "none" for all modules)'
        required: false
        type: choice
        options:
          - none
          - image
          - video
          - audio
          - all
        default: 'none'
      test_suite:
        description: |
          Leave empty → run all tests
          Single class → ImageGeneratorTests
          Specific method → ImageGeneratorTests#testGenerateImage
          Multiple classes → ClassA,ClassB
        required: false
        default: ""

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Java
        uses: actions/setup-java@v3
        with:
          distribution: temurin
          java-version: 17

      - name: Set up Chrome
        uses: browser-actions/setup-chrome@v1

      - name: Run Tests
        env:
          HEADLESS: true
        run: |
          ENV="${{ github.event.inputs.environment }}"
          MODULE="${{ github.event.inputs.module }}"
          TEST_SUITE="${{ github.event.inputs.test_suite }}"
          
          echo "Environment: $ENV"
          echo "Module: ${MODULE:-all modules}"
          echo "Test Suite: ${TEST_SUITE:-all tests}"
          
          # Build Maven profile flags
          PROFILE_FLAGS="-P$ENV"
          if [ -n "$MODULE" ] && [ "$MODULE" != "none" ]; then
            PROFILE_FLAGS="$PROFILE_FLAGS -P$MODULE"
          fi
          
          # Build Maven command
          if [ -z "$TEST_SUITE" ]; then
            echo "Running all tests for $ENV environment"
            mvn clean test $PROFILE_FLAGS
          else
            echo "Running selected test(s): $TEST_SUITE"
            mvn clean test $PROFILE_FLAGS -Dtest="$TEST_SUITE"
          fi
